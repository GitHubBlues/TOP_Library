<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href='style.css'> 

</head>


<body>
    <div class="title">Book Catalogue</div> 
    <div class="card-container"></div>   
    <div class="input-form"></div>   
    <button class="add-library-item">+</button>   

</body>

<script>
    const cardContainer = document.querySelector('.card-container');
    const inputForm = document.querySelector('.input-form');
    const addItemBtn = document.querySelector('.add-library-item');
    
    let emptyCardContainer = cardContainer.innerHTML;
    let emptyInputForm = inputForm.innerHTML;

    addItemBtn.addEventListener('click', (e) => addToLibrary())
    // Library = [["The Hobbit", "J.R.R.", "Tolkien", "295", "not read"],
    // ["Die Eiskonigin", "A.", "Neubauer", "60", "read"],
    // ["Du bist echt kuhl!", "Klaus","Puth", "60", "read"]];
    
    Library = [['The Hobbit', 'J.R.R.', 'Tolkien', '295', 'not read'],
               ['Die Eiskonigin', 'A.', 'Neubauer', '60', 'read'],
               ['Breakfast at Tiffany\'s', 'Truman', 'Capote', '157', 'read'],
               ]; 
 
    const inputTitle = document.createElement("input");
    const labelTitle = document.createElement("span");
    const inputAuthorFirst = document.createElement("input");
    const labelAuthorFirst = document.createElement("span");
    const inputAuthorLast = document.createElement("input");
    const labelAuthorLast = document.createElement("span");
    const inputPages = document.createElement("input");
    const labelPages = document.createElement("span");
    const inputRead = document.createElement("input");
    const labelRead = document.createElement("span");
    const inputSubmit = document.createElement("button");
   
    function addToLibrary(){
        
        makeInputForm();


        

             
        // let aa = document.querySelector('#box-name-last');
        // let bb = aa.value; 
        // console.log(bb);

    }
    
    function makeInputForm(){
        inputForm.style.display = 'flex';
    
        /* add input boxes*/
        labelTitle.textContent= 'Title';
        inputTitle.setAttribute("type", "text"); 
        inputTitle.setAttribute("id", "box-title");
        labelTitle.appendChild(inputTitle);
        inputForm.appendChild(labelTitle);
        
        labelAuthorFirst.textContent= 'Author, first name';
        inputAuthorFirst.setAttribute("type", "text"); 
        inputAuthorFirst.setAttribute("id", "box-name-first");
        labelAuthorFirst.appendChild(inputAuthorFirst);
        inputForm.appendChild(labelAuthorFirst);

        labelAuthorLast.textContent= 'Author, last name';
        inputAuthorLast.setAttribute("type", "text"); 
        inputAuthorLast.setAttribute("id", "box-name-last");
        labelAuthorLast.appendChild(inputAuthorLast);
        inputForm.appendChild(labelAuthorLast);
        
        labelPages.textContent= 'Number of pages';
        inputPages.setAttribute("type", "number"); 
        inputPages.setAttribute("id", "box-pages");
        labelPages.appendChild(inputPages);
        inputForm.appendChild(labelPages);
        
        labelRead.textContent= 'Read?';
        inputRead.setAttribute("type", "checkbox"); 
        inputRead.setAttribute("id", "box-read");
        labelRead.appendChild(inputRead);
        inputForm.appendChild(labelRead);

        inputSubmit.setAttribute("type", "button"); 
        inputSubmit.setAttribute("id", "box-sumbit");
        inputSubmit.textContent = "submit";
        inputForm.appendChild(inputSubmit);


        inputSubmit.addEventListener('click', handlerSubmitListener);
    }    

    
    function handlerSubmitListener(e){
        let repeatedTitle= Library.findIndex(element => element[0] == inputTitle.value);
        
        if (inputTitle.value.length<1){
            alert("You need to input at least a title");     
        } 
        else if (repeatedTitle>=0){
            alert(`OOps! The free version supports only unique titles 
            \nYou need to fork out \u00A3165 for the PRO version for creating more than one item with the same title.`); 

        }else{
            submitInput(e);
        }    
    }

        
    function submitInput(e){
        let read = inputRead.checked? "read": "not read"; 
        let recordLibrary = [inputTitle.value, inputAuthorFirst.value, inputAuthorLast.value,
        inputPages.value, read];

        console.log(recordLibrary);
        Library.push(recordLibrary);
        
        /* reset form and card container*/
        cardContainer.innerHTML = emptyCardContainer;
        inputSubmit.removeEventListener('click', handlerSubmitListener);

        inputForm.innerHTML = emptyInputForm;
        inputTitle.value = '';
        inputAuthorFirst.value = '';
        inputAuthorLast.value = '';
        inputPages.value = '';
        inputRead.checked = false;


        displayLibrary(Library);
        
    }
    

    function displayLibrary(Library){
        for (item in Library){

            let card = document.createElement('div');
            card.classList.add('card');

            let cardTitle = document.createElement('div');
            cardTitle.classList.add('card-title');
            cardTitle.textContent = Library[item][0];

            let cardAuthor = document.createElement('div');
            cardAuthor.classList.add('card-author');
            cardAuthor.innerText = Library[item][1] + ' ' + Library[item][2];

            let cardPages = document.createElement('div');
            cardPages.classList.add('card-pages');
            cardPages.innerText= Library[item][3];
            
            let readBtn = document.createElement('button');
            if (Library[item][4]=='read'){
                readBtn.classList.add('btn-read');
                readBtn.innerText = 'read';
                readBtn.addEventListener('click', (e) => {readToggle(e)});
            } else if (Library[item][4]=='not read'){
                readBtn.classList.add('btn-not-read');
                readBtn.innerText = 'not read';
                readBtn.addEventListener('click', (e) => {readToggle(e)});
            }
            
            let deleteBtn = document.createElement('button');
            deleteBtn.classList.add('btn-delete');
            deleteBtn.innerText= "revome";
            deleteBtn.addEventListener('click', handlerDeleteListener) 

            card.appendChild(cardTitle);
            card.appendChild(cardAuthor);
            card.appendChild(cardPages);
            card.appendChild(readBtn);
            card.appendChild(deleteBtn);

            cardContainer.appendChild(card);
        }
    }


    function handlerDeleteListener(e){
 
        let getTitle = e.target.parentElement.childNodes[0].innerText;

        const deleteIndex= Library.findIndex(element => element[0] == getTitle);
        
        cardContainer.innerHTML = emptyCardContainer;
        Library.splice(deleteIndex, 1);
        displayLibrary(Library);
    }


    function readToggle(e){
        if (e.target.innerText == 'read'){
            e.target.innerText = 'not read';
            const parent = e.currentTarget.parentNode;
            tmp = parent.childNodes[0].innerText;
            idx = Library.findIndex(element => element[0] == tmp);
            Library[idx][4] = 'not read';
            
        } else if (e.target.innerText == 'not read'){
            e.target.innerText = 'read';
            const parent = e.currentTarget.parentNode;
            tmp = parent.childNodes[0].innerText;
            idx = Library.findIndex(element => element[0] == tmp);
            Library[idx][4] = 'read';
        }
    }


    displayLibrary(Library);
    console.log(Library);

    // makeLibraryItem.prototype.info = function() {
    //     tmp = this.title + " by " + this.authFirstName + " " + this.authLastName + ", " + this.nPages + " pages, read? " + this.wasFinished;         
    //     return tmp; 
    // }

    // function makeLibraryItem(title, name1, name2, pages, read){
    //     this.title = title;
    //     this.authFirstName = name1;
    //     this.authLastName = name2;
    //     this.nPages = pages;
    //     this.wasFinished = read;
    // } 

    // let theHobbit = new makeLibraryItem('The Mobbit', 'J.R.R.', 'Tolkien', '295', 'not read');

    //console.log(theHobbit)
    //console.log(theHobbit.info());
    //console.log(Library.length);
    //console.log(Library[1][0]);
    //console.log(Library[0][1]);


                // inputTitle.addEventListener('keyup', (e) => {
            // if (e.key == 'Enter') {
            //    console.log("hitted enter");

            //} 
            //});



</script>

</html>
